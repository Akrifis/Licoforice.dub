<!DOCTYPE html>
<html>
<head>
  <title>Админка</title>
</head>
<body>
  <h1>Добавление серии</h1>
  
  <form id="episodeForm">
    <input type="text" id="title" placeholder="Название" required>
    <textarea id="description" placeholder="Описание" required></textarea>
    <input type="date" id="date" required>
    <input type="url" id="thumbnail" placeholder="URL картинки">
    <button type="submit">Добавить</button>
  </form>

  <script>
    const GITHUB_TOKEN = 'https://api.github.com/repos/Akrifis/series-content/contents/data.json'; // Хранить в .env в реальном проекте!
    const DATA_URL = 'https://api.github.com/repos/ваш-логин/ваш-репозиторий/contents/data.json';

    document.getElementById('episodeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const episode = {
        id: Date.now(),
        title: document.getElementById('title').value,
        description: document.getElementById('description').value,
        date: document.getElementById('date').value,
        thumbnail: document.getElementById('thumbnail').value || ''
      };

      try {
        // Получаем текущие данные
        const response = await fetch(DATA_URL, {
          headers: { Authorization: `token ${GITHUB_TOKEN}` }
        });
        
        const data = await response.json();
        const content = JSON.parse(atob(data.content));
        content.episodes.push(episode);
        
        // Обновляем файл
        await fetch(DATA_URL, {
          method: 'PUT',
          headers: { Authorization: `token ${GITHUB_TOKEN}` },
          body: JSON.stringify({
            message: 'Добавлена серия',
            content: btoa(JSON.stringify(content)),
            sha: data.sha
          })
        });
        
        alert('Серия добавлена!');
      } catch (error) {
        console.error('Ошибка:', error);
        alert('Ошибка при добавлении');
      }
    });
  </script>
</body>
</html>
